{% extends 'ui/base.html' %}
{% block title %}Create Protocol | CBPQueue{% endblock %}
{% block content %}
<div class="row-fluid">
    <div class="page-header">
        <h1>Create New Protocol</h1>
    </div>
    <form class="form" method="post" action=".">
        <div class="form-group">
            <label class="control-label" for="name">Name</label>
            <input type="text" class="form-control input-xlarge" id="name" name="name" required />
        </div>
        <h3>Steps</h3>
        <div class="step-container">
            <div class="protocol-step">
                <div class="form-group">
                    <label class="control-label" for="name">Software</label>
                    <input type="text" class="form-control input-xlarge" id="software" name="software" required />
                </div>
                <div class="form-group">
                    <label class="control-label" for="name">Parameter</label>
                    <input type="text" class="form-control input-xlarge" id="parameter" name="parameter" required />
                </div>
                <hr>
            </div>
        </div>
        <a class="btn btn-default" onclick="addStep();"><i class="glyphicon glyphicon-plus"></i>Add step</a>
        {% csrf_token %}
        <p></p>
        <div class="controls Validform_checktip text-warning"></div>
        <div class="form-actions">
            <button type="submit" class="btn btn-success btn-large btn-block">Create Protocol</button>
        </div>
    </form>
</div>
<div class="bs-callout bs-callout-info">
    You can use varibles or references when defining the parameters. Below are some of the system level variable:
    <ul>
        <li><code>InitInput</code>: The initial input files which maps to files you provide when you create a job.</li>
        <li><code>LastOutput</code>: Output files of last step.</li>
        <li><code>LastOutputN</code>: The n-th output file of last step (in alphabetical order).</li>
        <li><code>job</code>: job ID.</li>
        <li><code>ThreadN</code>: The number of CPUs in the running node.</li>
    </ul>
    All varibles should be surrounded by curly-braces, like {ThreadN}.
</div>
{% endblock %}
{% block script %}
    $("#add-protocol").addClass("active");
    $(document).ready(function(){
        var oTextbox = new AutoSuggestControl("parameter");
    });
    $("form").submit(function(){
		var self = $(this);
		$.post(self.attr("action"), self.serialize(), success, "json");
		return false;

		function success(data){
			if(data.status){
				Messenger().post({
					message: data.info,
					showCloseButton: true
				});
				self[0].reset();
			} else {
				Messenger().post({
					message: data.info,
					type: 'error',
					showCloseButton: true
				});
				$("#verify").val('');
			}
		}
    });
    function addStep(){
        new_step = $(".protocol-step:eq(0)").clone();
        new_step.find(":input").each(function(i){
            $(this).val("");
        });
        new_step.appendTo(".step-container");
    }
{% endblock %}